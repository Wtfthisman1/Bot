<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∏–ª–∏ —Å—Å—ã–ª–æ–∫</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
      overflow-x: hidden;
    }
    
    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ–Ω—ã */
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/><circle cx="10" cy="60" r="0.5" fill="white" opacity="0.1"/><circle cx="90" cy="40" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      pointer-events: none;
    }
    
    .container {
      width: 100%;
      max-width: 36rem;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 2.5rem;
      border-radius: 1.5rem;
      box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      position: relative;
      animation: slideUp 0.6s ease-out;
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .icon {
      width: 4rem;
      height: 4rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }
    
    .icon svg {
      width: 2rem;
      height: 2rem;
      fill: white;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      font-size: 0.95rem;
      color: #718096;
      line-height: 1.5;
    }
    
    .slots {
      margin-bottom: 2rem;
    }
    
    .slot-row {
      margin-bottom: 1.5rem;
      animation: fadeIn 0.5s ease-out;
      animation-fill-mode: both;
    }
    
    .slot-row:nth-child(1) { animation-delay: 0.1s; }
    .slot-row:nth-child(2) { animation-delay: 0.2s; }
    .slot-row:nth-child(3) { animation-delay: 0.3s; }
    .slot-row:nth-child(4) { animation-delay: 0.4s; }
    .slot-row:nth-child(5) { animation-delay: 0.5s; }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .slot-inputs {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 0.5rem;
    }
    
    @media (min-width: 768px) {
      .slot-inputs {
        flex-direction: row;
        gap: 1rem;
      }
    }
    
    .file-label {
      flex: 1;
      cursor: pointer;
      border: 2px dashed #cbd5e0;
      border-radius: 0.75rem;
      padding: 1rem;
      background: #f7fafc;
      color: #718096;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .file-label:hover {
      border-color: #667eea;
      background: #edf2f7;
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
    }
    
    .file-label.dragover {
      border-color: #667eea;
      background: #e6fffa;
      transform: scale(1.02);
    }
    
    .file-input {
      display: none;
    }
    
    .url-input {
      flex: 1;
      border: 2px solid #e2e8f0;
      border-radius: 0.75rem;
      padding: 1rem;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      background: #f7fafc;
    }
    
    .url-input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }
    
    .url-input.error {
      border-color: #e53e3e;
      background: #fed7d7;
    }
    
    .progress-container {
      margin-top: 0.5rem;
    }
    
    .progress-bar {
      height: 0.5rem;
      width: 100%;
      background: #e2e8f0;
      border-radius: 9999px;
      overflow: hidden;
      margin-bottom: 0.5rem;
      position: relative;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0;
      transition: width 0.3s ease;
      border-radius: 9999px;
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .speed {
      font-size: 0.8rem;
      text-align: right;
      color: #718096;
      user-select: none;
      visibility: hidden;
      font-weight: 500;
    }
    
    .slot-row[data-active="true"] .speed {
      visibility: visible;
      animation: fadeIn 0.3s ease;
    }
    
    .send-btn {
      width: 100%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 1rem 2rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .send-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
    }
    
    .send-btn:active {
      transform: translateY(0);
    }
    
    .send-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .send-btn.loading {
      pointer-events: none;
    }
    
    .send-btn.loading::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 1.5rem;
      height: 1.5rem;
      margin: -0.75rem 0 0 -0.75rem;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .status {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 0.75rem;
      font-size: 0.9rem;
      display: none;
    }
    
    .status.success {
      background: #c6f6d5;
      color: #22543d;
      border: 1px solid #9ae6b4;
      display: block;
    }
    
    .status.error {
      background: #fed7d7;
      color: #742a2a;
      border: 1px solid #feb2b2;
      display: block;
    }
    
    .file-info {
      font-size: 0.8rem;
      color: #718096;
      margin-top: 0.25rem;
    }
    
    .drag-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #a0aec0;
      font-size: 0.9rem;
      pointer-events: none;
      opacity: 0.7;
    }
    
    .debug-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-size: 12px;
      z-index: 1000;
      max-width: 300px;
    }
  </style>
</head>
<body>

<div class="debug-info" id="debugInfo">
  <div>üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...</div>
</div>

<div class="container">
  <div class="header">
    <div class="icon">
      <svg viewBox="0 0 24 24">
        <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/>
      </svg>
    </div>
    <h1>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h1>
    <p class="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 5 –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏</p>
  </div>

  <div id="slots" class="slots"></div>

  <button id="sendBtn" type="button" class="send-btn">
    <span class="btn-text">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã</span>
  </button>
  
  <div id="status" class="status"></div>
</div>

<script>
  // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
  
  function updateDebugInfo(message) {
    const debugInfo = document.getElementById('debugInfo');
    if (debugInfo) {
      debugInfo.innerHTML = `<div>${message}</div>`;
    }
    console.log(message);
  }
  
  updateDebugInfo('üìù –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è JavaScript...');
  
  const MAX = 5;
  const token = location.pathname.split('/').pop();
  const actionUrl = `/upload/${token}`;
  
  updateDebugInfo(`üîë –¢–æ–∫–µ–Ω: ${token}<br>üîó URL: ${actionUrl}`);

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª–æ—Ç–æ–≤ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  updateDebugInfo('üîß –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—ã...');
  const slotsRoot = document.getElementById('slots');

  for (let i = 0; i < MAX; i++) {
    const row = document.createElement('div');
    row.className = 'slot-row';
    row.innerHTML = `
      <div class="slot-inputs">
        <label class="file-label" data-slot="${i}">
          <div class="drag-hint">üé¨ –í—ã–±—Ä–∞—Ç—å –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç—å</div>
          <input type="file" name="file" class="file-input" data-slot="${i}" accept="audio/*,video/*,.mp3,.wav,.m4a,.mp4,.avi,.mkv,.mov,.webm,.flv,.wmv" />
        </label>
        <input type="text" name="url" placeholder="üîó https://youtube.com/..." class="url-input" autocomplete="off" data-slot="${i}" />
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div data-bar class="progress-fill"></div>
        </div>
        <div class="speed">0%</div>
      </div>
      <div class="file-info" data-file-info="${i}"></div>`;
    slotsRoot.append(row);
  }

  updateDebugInfo('‚úÖ –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Drag & Drop ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.querySelectorAll('.file-label').forEach(label => {
    label.addEventListener('dragover', (e) => {
      e.preventDefault();
      label.classList.add('dragover');
    });
    
    label.addEventListener('dragleave', () => {
      label.classList.remove('dragover');
    });
    
    label.addEventListener('drop', (e) => {
      e.preventDefault();
      label.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        const input = label.querySelector('input[type="file"]');
        input.files = files;
        updateFileInfo(input);
      }
    });
  });

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UX: –∏–º—è —Ñ–∞–π–ª–∞ & –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  slotsRoot.addEventListener('change', e => {
    if (e.target.type === 'file') {
      updateFileInfo(e.target);
    }
  });

  slotsRoot.addEventListener('input', e => {
    if (e.target.name === 'url') {
      validateUrl(e.target);
    }
  });

  function updateFileInfo(input) {
    const slot = input.dataset.slot;
    const fileInfo = document.querySelector(`[data-file-info="${slot}"]`);
    const label = input.closest('.file-label');
    
    if (input.files.length > 0) {
      const file = input.files[0];
      const size = formatFileSize(file.size);
      fileInfo.textContent = `üìÑ ${file.name} (${size})`;
      fileInfo.style.display = 'block';
      label.style.borderColor = '#48bb78';
      label.style.background = '#f0fff4';
    } else {
      fileInfo.style.display = 'none';
      label.style.borderColor = '#cbd5e0';
      label.style.background = '#f7fafc';
    }
  }

  function validateUrl(input) {
    const url = input.value.trim();
    if (url && !isValidUrl(url)) {
      input.classList.add('error');
      input.style.borderColor = '#e53e3e';
    } else {
      input.classList.remove('error');
      input.style.borderColor = url ? '#48bb78' : '#e2e8f0';
    }
  }

  function isValidUrl(string) {
    try {
      new URL(string);
      return true;
    } catch (_) {
      return false;
    }
  }

  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –æ—Ç–ø—Ä–∞–≤–∫–∞ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
  document.getElementById('sendBtn').addEventListener('click', () => {
    updateDebugInfo('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
    
    const form = new FormData();
    const slots = [...document.querySelectorAll('.slot-row')];
    const status = document.getElementById('status');
    const btn = document.getElementById('sendBtn');
    const btnText = btn.querySelector('.btn-text');

    // –°–±—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–∞
    status.className = 'status';
    status.style.display = 'none';

    slots.forEach(row => row.dataset.active = 'false');

    let any = false;
    let hasErrors = false;

    slots.forEach((row, idx) => {
      const file = row.querySelector('input[type="file"]').files[0];
      const url = row.querySelector('input[name="url"]').value.trim();

      if (file) {
        form.append('file', file);
        any = true;
        row.dataset.active = 'true';
      }
      if (url) {
        if (isValidUrl(url)) {
          form.append('url', url);
          any = true;
          row.dataset.active = 'true';
        } else {
          hasErrors = true;
        }
      }
    });

    if (hasErrors) {
      showStatus('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å—Å—ã–ª–æ–∫', 'error');
      updateDebugInfo('‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏');
      return;
    }

    if (!any) {
      showStatus('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É', 'error');
      updateDebugInfo('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
      return;
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    btn.classList.add('loading');
    btnText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

    const xhr = new XMLHttpRequest();
    const startTime = Date.now();

    xhr.upload.onprogress = ev => {
      if (!ev.lengthComputable) return;
      const pct = ev.loaded / ev.total;
      const speed = ev.loaded / ((Date.now() - startTime) / 1000);
      const speedStr = speed > 1e6 ? (speed/1e6).toFixed(1)+' MB/s' : (speed/1e3).toFixed(1)+' kB/s';

      slots.filter(r => r.dataset.active === 'true').forEach(r => {
        r.querySelector('[data-bar]').style.width = (pct*100)+'%';
        r.querySelector('.speed').textContent = (pct*100).toFixed(0)+'% ‚Ä¢ '+speedStr;
      });
    };

    xhr.onload = () => {
      slots.forEach(r => r.querySelector('[data-bar]').style.width = '100%');
      
      if (xhr.status === 200) {
        showStatus('–§–∞–π–ª—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å.', 'success');
        updateDebugInfo('‚úÖ –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
        setTimeout(() => location.reload(), 2000);
      } else {
        showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (xhr.responseText || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
        updateDebugInfo('‚ùå –û—à–∏–±–∫–∞: ' + xhr.status);
      }
      
      btn.classList.remove('loading');
      btnText.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã';
    };

    xhr.onerror = () => {
      showStatus('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.', 'error');
      updateDebugInfo('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
      btn.classList.remove('loading');
      btnText.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã';
    };

    updateDebugInfo('üåê –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...');
    xhr.open('POST', actionUrl);
    xhr.send(form);
  });

  function showStatus(message, type) {
    const status = document.getElementById('status');
    status.textContent = message;
    status.className = `status ${type}`;
    status.style.display = 'block';
  }
  
  updateDebugInfo('üéâ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');
</script>
</body>
</html>
